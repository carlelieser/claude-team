{"version":3,"file":"BkUGLLRg.js","sources":["../../../../../../src/lib/stores/approvals.svelte.ts"],"sourcesContent":["/**\n * Approval store using Svelte 5 runes\n */\n\nimport {\n  ipc,\n  type ApprovalDto,\n  type ApprovalFilterDto,\n  type ApprovalStatus,\n} from '$lib/ipc/client';\n\nclass ApprovalStore {\n  approvals = $state<ApprovalDto[]>([]);\n  loading = $state(false);\n  error = $state<string | null>(null);\n  filter = $state<ApprovalFilterDto>({ status: 'pending' });\n  count = $state(0);\n\n  pendingApprovals = $derived(\n    this.approvals.filter((a) => a.approvalStatus === 'pending')\n  );\n  approvedApprovals = $derived(\n    this.approvals.filter((a) => a.approvalStatus === 'approved')\n  );\n  rejectedApprovals = $derived(\n    this.approvals.filter((a) => a.approvalStatus === 'rejected')\n  );\n\n  private _unsubscribeUpdated: (() => void) | null = null;\n  private _unsubscribeRequired: (() => void) | null = null;\n\n  async load(filter?: ApprovalFilterDto): Promise<void> {\n    this.loading = true;\n    this.error = null;\n\n    if (filter) {\n      this.filter = filter;\n    }\n\n    try {\n      const result = await ipc.approval.list(this.filter);\n\n      if (result.ok) {\n        this.approvals = [...result.value];\n      } else {\n        this.error = result.error.message;\n      }\n\n      await this.refreshCount();\n    } catch (e) {\n      this.error = e instanceof Error ? e.message : 'Unknown error';\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  async refreshCount(projectId?: string): Promise<void> {\n    try {\n      const result = await ipc.approval.count(projectId);\n\n      if (result.ok) {\n        this.count = result.value;\n      }\n    } catch (e) {\n      console.error('Failed to refresh approval count:', e);\n    }\n  }\n\n  async approve(id: string): Promise<ApprovalDto | null> {\n    try {\n      const result = await ipc.approval.approve(id);\n\n      if (result.ok) {\n        this.updateApprovalInList(result.value);\n        await this.refreshCount();\n        return result.value;\n      } else {\n        this.error = result.error.message;\n        return null;\n      }\n    } catch (e) {\n      this.error = e instanceof Error ? e.message : 'Unknown error';\n      return null;\n    }\n  }\n\n  async reject(id: string, reason?: string): Promise<ApprovalDto | null> {\n    try {\n      const result = await ipc.approval.reject(id, reason);\n\n      if (result.ok) {\n        this.updateApprovalInList(result.value);\n        await this.refreshCount();\n        return result.value;\n      } else {\n        this.error = result.error.message;\n        return null;\n      }\n    } catch (e) {\n      this.error = e instanceof Error ? e.message : 'Unknown error';\n      return null;\n    }\n  }\n\n  setFilter(filter: ApprovalFilterDto): void {\n    this.filter = filter;\n    this.load();\n  }\n\n  subscribe(): void {\n    this._unsubscribeUpdated = ipc.on.approvalUpdated((approval: ApprovalDto) => {\n      this.updateApprovalInList(approval);\n    });\n\n    this._unsubscribeRequired = ipc.on.approvalRequired(() => {\n      this.load();\n      this.refreshCount();\n    });\n  }\n\n  unsubscribe(): void {\n    if (this._unsubscribeUpdated) {\n      this._unsubscribeUpdated();\n      this._unsubscribeUpdated = null;\n    }\n    if (this._unsubscribeRequired) {\n      this._unsubscribeRequired();\n      this._unsubscribeRequired = null;\n    }\n  }\n\n  getById(id: string): ApprovalDto | undefined {\n    return this.approvals.find((a) => a.id === id);\n  }\n\n  getByStatus(status: ApprovalStatus): ApprovalDto[] {\n    return this.approvals.filter((a) => a.approvalStatus === status);\n  }\n\n  private updateApprovalInList(approval: ApprovalDto): void {\n    const index = this.approvals.findIndex((a) => a.id === approval.id);\n    if (index !== -1) {\n      this.approvals[index] = approval;\n    } else {\n      this.approvals = [...this.approvals, approval];\n    }\n  }\n}\n\nexport const approvalStore = new ApprovalStore();\n"],"names":["ApprovalStore","$.state","$.proxy","value","#loading","#error","#count","a","filter","result","ipc","projectId","id","reason","e","approval","status","index","approvalStore"],"mappings":"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"}