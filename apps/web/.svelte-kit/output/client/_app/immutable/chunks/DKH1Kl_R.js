import{b as a,d as u,g as r,e as i,u as n}from"./oD9g-Rhu.js";import{i as o}from"./CtLtXU_n.js";class d{#s=a(u([]));get tasks(){return r(this.#s)}set tasks(s){i(this.#s,s,!0)}#t=a(!1);get loading(){return r(this.#t)}set loading(s){i(this.#t,s,!0)}#e=a(null);get error(){return r(this.#e)}set error(s){i(this.#e,s,!0)}#r=a(u({}));get filter(){return r(this.#r)}set filter(s){i(this.#r,s,!0)}#i=a("kanban");get viewMode(){return r(this.#i)}set viewMode(s){i(this.#i,s,!0)}#a=n(()=>this.tasks.filter(s=>s.status==="pending"));get pendingTasks(){return r(this.#a)}set pendingTasks(s){i(this.#a,s)}#n=n(()=>this.tasks.filter(s=>s.status==="in_progress"));get inProgressTasks(){return r(this.#n)}set inProgressTasks(s){i(this.#n,s)}#o=n(()=>this.tasks.filter(s=>s.status==="completed"));get completedTasks(){return r(this.#o)}set completedTasks(s){i(this.#o,s)}#l=n(()=>this.tasks.filter(s=>s.status==="failed"));get failedTasks(){return r(this.#l)}set failedTasks(s){i(this.#l,s)}#u=n(()=>this.tasks.filter(s=>s.status==="canceled"));get canceledTasks(){return r(this.#u)}set canceledTasks(s){i(this.#u,s)}_unsubscribeUpdated=null;async load(s){this.loading=!0,this.error=null,s&&(this.filter=s);try{const t=await o.task.list(this.filter);t.ok?this.tasks=[...t.value]:this.error=t.error.message}catch(t){this.error=t instanceof Error?t.message:"Unknown error"}finally{this.loading=!1}}async create(s){try{const t=await o.task.create(s);return t.ok?(this.tasks=[...this.tasks,t.value],t.value):(this.error=t.error.message,null)}catch(t){return this.error=t instanceof Error?t.message:"Unknown error",null}}async update(s,t){try{const e=await o.task.update(s,t);if(e.ok){const l=this.tasks.findIndex(h=>h.id===s);return l!==-1&&(this.tasks[l]=e.value),e.value}else return this.error=e.error.message,null}catch(e){return this.error=e instanceof Error?e.message:"Unknown error",null}}async cancel(s){try{const t=await o.task.cancel(s);if(t.ok){const e=this.tasks.findIndex(l=>l.id===s);return e!==-1&&(this.tasks[e]={...this.tasks[e],status:"canceled"}),!0}else return this.error=t.error.message,!1}catch(t){return this.error=t instanceof Error?t.message:"Unknown error",!1}}setFilter(s){this.filter=s,this.load()}setViewMode(s){this.viewMode=s}subscribe(){this._unsubscribeUpdated=o.on.taskUpdated(s=>{const t=this.tasks.findIndex(e=>e.id===s.id);t!==-1?this.tasks[t]=s:this.tasks=[...this.tasks,s]})}unsubscribe(){this._unsubscribeUpdated&&(this._unsubscribeUpdated(),this._unsubscribeUpdated=null)}getById(s){return this.tasks.find(t=>t.id===s)}getByStatus(s){return this.tasks.filter(t=>t.status===s)}}const g=new d;export{g as t};
//# sourceMappingURL=DKH1Kl_R.js.map
