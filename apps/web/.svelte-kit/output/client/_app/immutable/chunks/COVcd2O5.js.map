{"version":3,"file":"COVcd2O5.js","sources":["../../../../../../src/lib/stores/agents.svelte.ts"],"sourcesContent":["/**\n * Agent store using Svelte 5 runes\n */\n\nimport { ipc, type AgentDto, type AgentProgressPayload } from '$lib/ipc/client';\n\nclass AgentStore {\n  agents = $state<AgentDto[]>([]);\n  loading = $state(false);\n  error = $state<string | null>(null);\n\n  activeAgents = $derived(this.agents.filter((a) => a.status === 'executing'));\n  idleAgents = $derived(this.agents.filter((a) => a.status === 'idle'));\n  pausedAgents = $derived(this.agents.filter((a) => a.status === 'paused'));\n\n  private _unsubscribeProgress: (() => void) | null = null;\n\n  async load(): Promise<void> {\n    this.loading = true;\n    this.error = null;\n\n    try {\n      const result = await ipc.agent.list();\n\n      if (result.ok) {\n        this.agents = [...result.value];\n      } else {\n        this.error = result.error.message;\n      }\n    } catch (e) {\n      this.error = e instanceof Error ? e.message : 'Unknown error';\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  async pause(agentId: string): Promise<void> {\n    const result = await ipc.agent.pause(agentId);\n\n    if (result.ok) {\n      const index = this.agents.findIndex((a) => a.id === agentId);\n      if (index !== -1) {\n        this.agents[index] = { ...this.agents[index]!, status: 'paused' };\n      }\n    }\n  }\n\n  async resume(agentId: string): Promise<void> {\n    const result = await ipc.agent.resume(agentId);\n\n    if (result.ok) {\n      const agent = this.agents.find((a) => a.id === agentId);\n      if (agent) {\n        const newStatus = agent.currentTaskId ? 'executing' : 'idle';\n        const index = this.agents.findIndex((a) => a.id === agentId);\n        if (index !== -1) {\n          this.agents[index] = { ...this.agents[index]!, status: newStatus };\n        }\n      }\n    }\n  }\n\n  subscribe(): void {\n    this._unsubscribeProgress = ipc.on.agentProgress((payload: AgentProgressPayload) => {\n      const index = this.agents.findIndex((a) => a.id === payload.agentId);\n      if (index !== -1) {\n        this.agents[index] = {\n          ...this.agents[index]!,\n          status: 'executing',\n          currentTaskId: payload.taskId,\n        };\n      }\n    });\n  }\n\n  unsubscribe(): void {\n    if (this._unsubscribeProgress) {\n      this._unsubscribeProgress();\n      this._unsubscribeProgress = null;\n    }\n  }\n\n  getById(id: string): AgentDto | undefined {\n    return this.agents.find((a) => a.id === id);\n  }\n}\n\nexport const agentStore = new AgentStore();\n"],"names":["AgentStore","$.state","$.proxy","value","#loading","#error","a","result","ipc","e","agentId","index","agent","newStatus","payload","id","agentStore"],"mappings":"2FAMM,MAAAA,CAAW,IACNC,EAAAC,EAAA,CAAA,CAAA,CAAA,MAAT,QAAA,uBAAA,OAAAC,EAAA,iBACUC,GAAAH,EAAO,EAAK,MAAtB,SAAA,uBAAA,QAAAE,EAAA,iBACQE,GAAAJ,EAAsB,IAAI,MAAlC,OAAA,uBAAA,MAAAE,EAAA,0BAEwB,KAAK,OAAO,OAAQG,GAAMA,EAAE,SAAW,WAAW,CAAA,MAA1E,cAAA,uBAAA,aAAAH,EAAA,uBACsB,KAAK,OAAO,OAAQG,GAAMA,EAAE,SAAW,MAAM,CAAA,MAAnE,YAAA,uBAAA,WAAAH,EAAA,uBACwB,KAAK,OAAO,OAAQG,GAAMA,EAAE,SAAW,QAAQ,CAAA,MAAvE,cAAA,uBAAA,aAAAH,EAAA,cAEQ,qBAA4C,KAE9C,MAAA,MAAsB,CAC1B,KAAK,QAAU,GACf,KAAK,MAAQ,QAET,CACI,MAAAI,EAAA,MAAeC,EAAI,MAAM,KAAA,EAE3BD,EAAO,GACT,KAAK,OAAA,CAAA,GAAaA,EAAO,KAAK,EAE9B,KAAK,MAAQA,EAAO,MAAM,OAE9B,OAASE,EAAG,CACV,KAAK,MAAQA,aAAa,MAAQA,EAAE,QAAU,eAChD,QAAA,CACE,KAAK,QAAU,EACjB,CACF,OAEM,MAAMC,EAAgC,WACrBF,EAAI,MAAM,MAAME,CAAO,GAEjC,GAAI,CACP,MAAAC,EAAQ,KAAK,OAAO,UAAWL,GAAMA,EAAE,KAAOI,CAAO,EACvDC,SACF,KAAK,OAAOA,CAAK,EAAA,CAAA,GAAS,KAAK,OAAOA,CAAK,EAAI,OAAQ,QAAA,EAE3D,CACF,OAEM,OAAOD,EAAgC,WACtBF,EAAI,MAAM,OAAOE,CAAO,GAElC,GAAI,CACP,MAAAE,EAAQ,KAAK,OAAO,KAAMN,GAAMA,EAAE,KAAOI,CAAO,EAClD,GAAAE,EAAO,CACH,MAAAC,EAAYD,EAAM,cAAgB,YAAc,OAChDD,EAAQ,KAAK,OAAO,UAAWL,GAAMA,EAAE,KAAOI,CAAO,EACvDC,SACF,KAAK,OAAOA,CAAK,EAAA,CAAA,GAAS,KAAK,OAAOA,CAAK,EAAI,OAAQE,CAAA,EAE3D,CACF,CACF,CAEA,WAAkB,CAChB,KAAK,qBAAuBL,EAAI,GAAG,cAAeM,GAAkC,CAC5E,MAAAH,EAAQ,KAAK,OAAO,UAAWL,GAAMA,EAAE,KAAOQ,EAAQ,OAAO,EAC/DH,SACF,KAAK,OAAOA,CAAK,EAAA,IACZ,KAAK,OAAOA,CAAK,EACpB,OAAQ,YACR,cAAeG,EAAQ,QAG7B,CAAC,CACH,CAEA,aAAoB,CACd,KAAK,uBACP,KAAK,qBAAA,EACL,KAAK,qBAAuB,KAEhC,CAEA,QAAQC,EAAkC,QACjC,KAAK,OAAO,KAAMT,GAAMA,EAAE,KAAOS,CAAE,CAC5C,CACF,CAEa,MAAAC,MAAiBhB"}