import{b as o,d as n,g as s,e as a,u as p}from"./oD9g-Rhu.js";import{i}from"./CtLtXU_n.js";class l{#r=o(n([]));get approvals(){return s(this.#r)}set approvals(r){a(this.#r,r,!0)}#e=o(!1);get loading(){return s(this.#e)}set loading(r){a(this.#e,r,!0)}#t=o(null);get error(){return s(this.#t)}set error(r){a(this.#t,r,!0)}#s=o(n({status:"pending"}));get filter(){return s(this.#s)}set filter(r){a(this.#s,r,!0)}#a=o(0);get count(){return s(this.#a)}set count(r){a(this.#a,r,!0)}#i=p(()=>this.approvals.filter(r=>r.approvalStatus==="pending"));get pendingApprovals(){return s(this.#i)}set pendingApprovals(r){a(this.#i,r)}#o=p(()=>this.approvals.filter(r=>r.approvalStatus==="approved"));get approvedApprovals(){return s(this.#o)}set approvedApprovals(r){a(this.#o,r)}#p=p(()=>this.approvals.filter(r=>r.approvalStatus==="rejected"));get rejectedApprovals(){return s(this.#p)}set rejectedApprovals(r){a(this.#p,r)}_unsubscribeUpdated=null;_unsubscribeRequired=null;async load(r){this.loading=!0,this.error=null,r&&(this.filter=r);try{const e=await i.approval.list(this.filter);e.ok?this.approvals=[...e.value]:this.error=e.error.message,await this.refreshCount()}catch(e){this.error=e instanceof Error?e.message:"Unknown error"}finally{this.loading=!1}}async refreshCount(r){try{const e=await i.approval.count(r);e.ok&&(this.count=e.value)}catch(e){console.error("Failed to refresh approval count:",e)}}async approve(r){try{const e=await i.approval.approve(r);return e.ok?(this.updateApprovalInList(e.value),await this.refreshCount(),e.value):(this.error=e.error.message,null)}catch(e){return this.error=e instanceof Error?e.message:"Unknown error",null}}async reject(r,e){try{const t=await i.approval.reject(r,e);return t.ok?(this.updateApprovalInList(t.value),await this.refreshCount(),t.value):(this.error=t.error.message,null)}catch(t){return this.error=t instanceof Error?t.message:"Unknown error",null}}setFilter(r){this.filter=r,this.load()}subscribe(){this._unsubscribeUpdated=i.on.approvalUpdated(r=>{this.updateApprovalInList(r)}),this._unsubscribeRequired=i.on.approvalRequired(()=>{this.load(),this.refreshCount()})}unsubscribe(){this._unsubscribeUpdated&&(this._unsubscribeUpdated(),this._unsubscribeUpdated=null),this._unsubscribeRequired&&(this._unsubscribeRequired(),this._unsubscribeRequired=null)}getById(r){return this.approvals.find(e=>e.id===r)}getByStatus(r){return this.approvals.filter(e=>e.approvalStatus===r)}updateApprovalInList(r){const e=this.approvals.findIndex(t=>t.id===r.id);e!==-1?this.approvals[e]=r:this.approvals=[...this.approvals,r]}}const v=new l;export{v as a};
//# sourceMappingURL=BkUGLLRg.js.map
