import{b as i,d as l,g as s,e as r,u}from"./oD9g-Rhu.js";import{i as n}from"./CtLtXU_n.js";const a=1e3;class h{#e=i(l([]));get events(){return s(this.#e)}set events(e){r(this.#e,e,!0)}#t=i(!1);get loading(){return s(this.#t)}set loading(e){r(this.#t,e,!0)}#s=i(null);get error(){return s(this.#s)}set error(e){r(this.#s,e,!0)}#r=i(l({}));get filter(){return s(this.#r)}set filter(e){r(this.#r,e,!0)}#i=i(!1);get isStreaming(){return s(this.#i)}set isStreaming(e){r(this.#i,e,!0)}#n=u(()=>()=>{let e=this.events;return this.filter.type&&(e=e.filter(t=>t.type.startsWith(this.filter.type))),this.filter.source&&(e=e.filter(t=>t.source===this.filter.source)),this.filter.projectId&&(e=e.filter(t=>t.projectId===this.filter.projectId)),e});get filteredEvents(){return s(this.#n)}set filteredEvents(e){r(this.#n,e)}_unsubscribeNew=null;async load(e){this.loading=!0,this.error=null,e&&(this.filter=e);try{const t=await n.event.list({...this.filter,limit:this.filter.limit??100});t.ok?this.events=[...t.value]:this.error=t.error.message}catch(t){this.error=t instanceof Error?t.message:"Unknown error"}finally{this.loading=!1}}async startStreaming(e){if(this.isStreaming)return;const t=await n.event.subscribe(e);t.ok?(this.isStreaming=!0,this._subscribeToNewEvents()):this.error=t.error.message}async stopStreaming(){if(!this.isStreaming)return;(await n.event.unsubscribe()).ok&&(this.isStreaming=!1,this._unsubscribeFromNewEvents())}setFilter(e){this.filter=e}clearEvents(){this.events=[]}_subscribeToNewEvents(){this._unsubscribeNew=n.on.eventNew(e=>{this.events=[e,...this.events].slice(0,a)})}_unsubscribeFromNewEvents(){this._unsubscribeNew&&(this._unsubscribeNew(),this._unsubscribeNew=null)}getByType(e){return this.events.filter(t=>t.type===e)}getRecent(e){return this.events.slice(0,e)}}const g=new h;export{g as e};
//# sourceMappingURL=DXaP2PVZ.js.map
