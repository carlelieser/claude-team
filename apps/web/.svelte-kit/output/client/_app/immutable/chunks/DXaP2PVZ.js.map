{"version":3,"file":"DXaP2PVZ.js","sources":["../../../../../../src/lib/stores/events.svelte.ts"],"sourcesContent":["/**\n * Event store using Svelte 5 runes\n */\n\nimport { ipc, type EventDto, type EventFilterDto } from '$lib/ipc/client';\n\nconst MAX_EVENTS = 1000;\n\nclass EventStore {\n  events = $state<EventDto[]>([]);\n  loading = $state(false);\n  error = $state<string | null>(null);\n  filter = $state<EventFilterDto>({});\n  isStreaming = $state(false);\n\n  filteredEvents = $derived(() => {\n    let result = this.events;\n\n    if (this.filter.type) {\n      result = result.filter((e) => e.type.startsWith(this.filter.type!));\n    }\n\n    if (this.filter.source) {\n      result = result.filter((e) => e.source === this.filter.source);\n    }\n\n    if (this.filter.projectId) {\n      result = result.filter((e) => e.projectId === this.filter.projectId);\n    }\n\n    return result;\n  });\n\n  private _unsubscribeNew: (() => void) | null = null;\n\n  async load(filter?: EventFilterDto): Promise<void> {\n    this.loading = true;\n    this.error = null;\n\n    if (filter) {\n      this.filter = filter;\n    }\n\n    try {\n      const result = await ipc.event.list({\n        ...this.filter,\n        limit: this.filter.limit ?? 100,\n      });\n\n      if (result.ok) {\n        this.events = [...result.value];\n      } else {\n        this.error = result.error.message;\n      }\n    } catch (e) {\n      this.error = e instanceof Error ? e.message : 'Unknown error';\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  async startStreaming(types?: readonly string[]): Promise<void> {\n    if (this.isStreaming) {\n      return;\n    }\n\n    const result = await ipc.event.subscribe(types);\n\n    if (result.ok) {\n      this.isStreaming = true;\n      this._subscribeToNewEvents();\n    } else {\n      this.error = result.error.message;\n    }\n  }\n\n  async stopStreaming(): Promise<void> {\n    if (!this.isStreaming) {\n      return;\n    }\n\n    const result = await ipc.event.unsubscribe();\n\n    if (result.ok) {\n      this.isStreaming = false;\n      this._unsubscribeFromNewEvents();\n    }\n  }\n\n  setFilter(filter: EventFilterDto): void {\n    this.filter = filter;\n  }\n\n  clearEvents(): void {\n    this.events = [];\n  }\n\n  private _subscribeToNewEvents(): void {\n    this._unsubscribeNew = ipc.on.eventNew((event: EventDto) => {\n      this.events = [event, ...this.events].slice(0, MAX_EVENTS);\n    });\n  }\n\n  private _unsubscribeFromNewEvents(): void {\n    if (this._unsubscribeNew) {\n      this._unsubscribeNew();\n      this._unsubscribeNew = null;\n    }\n  }\n\n  getByType(type: string): EventDto[] {\n    return this.events.filter((e) => e.type === type);\n  }\n\n  getRecent(count: number): EventDto[] {\n    return this.events.slice(0, count);\n  }\n}\n\nexport const eventStore = new EventStore();\n"],"names":["MAX_EVENTS","EventStore","$.state","$.proxy","value","#loading","#error","#isStreaming","result","e","filter","ipc","types","event","type","count","eventStore"],"mappings":"2FAMM,MAAAA,EAAa,IAEb,MAAAC,CAAW,IACNC,EAAAC,EAAA,CAAA,CAAA,CAAA,MAAT,QAAA,uBAAA,OAAAC,EAAA,iBACUC,GAAAH,EAAO,EAAK,MAAtB,SAAA,uBAAA,QAAAE,EAAA,iBACQE,GAAAJ,EAAsB,IAAI,MAAlC,OAAA,uBAAA,MAAAE,EAAA,oBACSF,EAAAC,EAAA,CAAA,CAAA,CAAA,MAAT,QAAA,uBAAA,OAAAC,EAAA,iBACcG,GAAAL,EAAO,EAAK,MAA1B,aAAA,uBAAA,YAAAE,EAAA,8BAEgC,KAC1BI,EAAS,KAAK,OAEd,OAAA,KAAK,OAAO,OACdA,EAASA,EAAO,OAAQC,GAAMA,EAAE,KAAK,WAAW,KAAK,OAAO,IAAK,CAAA,GAG/D,KAAK,OAAO,SACdD,EAASA,EAAO,OAAQC,GAAMA,EAAE,SAAW,KAAK,OAAO,MAAM,GAG3D,KAAK,OAAO,YACdD,EAASA,EAAO,OAAQC,GAAMA,EAAE,YAAc,KAAK,OAAO,SAAS,GAG9DD,CACT,CAAC,MAhBD,gBAAA,uBAAA,eAAAJ,EAAA,cAkBQ,gBAAuC,WAEzC,KAAKM,EAAwC,CACjD,KAAK,QAAU,GACf,KAAK,MAAQ,KAETA,IACF,KAAK,OAASA,MAGZ,CACI,MAAAF,QAAeG,EAAI,MAAM,SAC1B,KAAK,OACR,MAAO,KAAK,OAAO,OAAS,GAAA,CAAA,EAG1BH,EAAO,GACT,KAAK,OAAA,CAAA,GAAaA,EAAO,KAAK,EAE9B,KAAK,MAAQA,EAAO,MAAM,OAE9B,OAASC,EAAG,CACV,KAAK,MAAQA,aAAa,MAAQA,EAAE,QAAU,eAChD,QAAA,CACE,KAAK,QAAU,EACjB,CACF,OAEM,eAAeG,EAA0C,IACzD,KAAK,mBAIH,MAAAJ,QAAeG,EAAI,MAAM,UAAUC,CAAK,EAE1CJ,EAAO,IACT,KAAK,YAAc,GACnB,KAAK,sBAAA,GAEL,KAAK,MAAQA,EAAO,MAAM,OAE9B,CAEM,MAAA,eAA+B,KAC9B,KAAK,oBAIJ,MAAeG,EAAI,MAAM,YAAA,GAEpB,KACT,KAAK,YAAc,GACnB,KAAK,0BAAA,EAET,CAEA,UAAUD,EAA8B,CACtC,KAAK,OAASA,CAChB,CAEA,aAAoB,CAClB,KAAK,SACP,CAEQ,uBAA8B,CACpC,KAAK,gBAAkBC,EAAI,GAAG,SAAUE,GAAoB,CAC1D,KAAK,OAAA,CAAUA,EAAA,GAAU,KAAK,MAAM,EAAE,MAAM,EAAGb,CAAU,CAC3D,CAAC,CACH,CAEQ,2BAAkC,CACpC,KAAK,kBACP,KAAK,gBAAA,EACL,KAAK,gBAAkB,KAE3B,CAEA,UAAUc,EAA0B,QAC3B,KAAK,OAAO,OAAQL,GAAMA,EAAE,OAASK,CAAI,CAClD,CAEA,UAAUC,EAA2B,CAC5B,OAAA,KAAK,OAAO,MAAM,EAAGA,CAAK,CACnC,CACF,CAEa,MAAAC,MAAiBf"}