{"version":3,"file":"events.svelte.js","sources":["../../../../src/lib/stores/events.svelte.ts"],"sourcesContent":["/**\n * Event store using Svelte 5 runes\n */\n\nimport { ipc, type EventDto, type EventFilterDto } from '$lib/ipc/client';\n\nconst MAX_EVENTS = 1000;\n\nclass EventStore {\n  events = $state<EventDto[]>([]);\n  loading = $state(false);\n  error = $state<string | null>(null);\n  filter = $state<EventFilterDto>({});\n  isStreaming = $state(false);\n\n  filteredEvents = $derived(() => {\n    let result = this.events;\n\n    if (this.filter.type) {\n      result = result.filter((e) => e.type.startsWith(this.filter.type!));\n    }\n\n    if (this.filter.source) {\n      result = result.filter((e) => e.source === this.filter.source);\n    }\n\n    if (this.filter.projectId) {\n      result = result.filter((e) => e.projectId === this.filter.projectId);\n    }\n\n    return result;\n  });\n\n  private _unsubscribeNew: (() => void) | null = null;\n\n  async load(filter?: EventFilterDto): Promise<void> {\n    this.loading = true;\n    this.error = null;\n\n    if (filter) {\n      this.filter = filter;\n    }\n\n    try {\n      const result = await ipc.event.list({\n        ...this.filter,\n        limit: this.filter.limit ?? 100,\n      });\n\n      if (result.ok) {\n        this.events = [...result.value];\n      } else {\n        this.error = result.error.message;\n      }\n    } catch (e) {\n      this.error = e instanceof Error ? e.message : 'Unknown error';\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  async startStreaming(types?: readonly string[]): Promise<void> {\n    if (this.isStreaming) {\n      return;\n    }\n\n    const result = await ipc.event.subscribe(types);\n\n    if (result.ok) {\n      this.isStreaming = true;\n      this._subscribeToNewEvents();\n    } else {\n      this.error = result.error.message;\n    }\n  }\n\n  async stopStreaming(): Promise<void> {\n    if (!this.isStreaming) {\n      return;\n    }\n\n    const result = await ipc.event.unsubscribe();\n\n    if (result.ok) {\n      this.isStreaming = false;\n      this._unsubscribeFromNewEvents();\n    }\n  }\n\n  setFilter(filter: EventFilterDto): void {\n    this.filter = filter;\n  }\n\n  clearEvents(): void {\n    this.events = [];\n  }\n\n  private _subscribeToNewEvents(): void {\n    this._unsubscribeNew = ipc.on.eventNew((event: EventDto) => {\n      this.events = [event, ...this.events].slice(0, MAX_EVENTS);\n    });\n  }\n\n  private _unsubscribeFromNewEvents(): void {\n    if (this._unsubscribeNew) {\n      this._unsubscribeNew();\n      this._unsubscribeNew = null;\n    }\n  }\n\n  getByType(type: string): EventDto[] {\n    return this.events.filter((e) => e.type === type);\n  }\n\n  getRecent(count: number): EventDto[] {\n    return this.events.slice(0, count);\n  }\n}\n\nexport const eventStore = new EventStore();\n"],"names":[],"mappings":";;AAMM,MAAA,aAAa;AAEb,MAAA,WAAW;AAAA,EACf,SAAA,CAAA;AAAA,EACA,UAAiB;AAAA,EACjB,QAA8B;AAAA,EAC9B,SAAA,CAAA;AAAA,EACA,cAAqB;AAAA,wCAEW;QAC1B,SAAS,KAAK;AAEd,QAAA,KAAK,OAAO,MAAM;AACpB,eAAS,OAAO,OAAA,CAAQ,MAAM,EAAE,KAAK,WAAW,KAAK,OAAO,IAAK,CAAA;AAAA,IACnE;AAEI,QAAA,KAAK,OAAO,QAAQ;AACtB,eAAS,OAAO,QAAQ,MAAM,EAAE,WAAW,KAAK,OAAO,MAAM;AAAA,IAC/D;AAEI,QAAA,KAAK,OAAO,WAAW;AACzB,eAAS,OAAO,QAAQ,MAAM,EAAE,cAAc,KAAK,OAAO,SAAS;AAAA,IACrE;WAEO;AAAA,EACT,CAAC;AAAA,MAhBD,iBAAA;;;;;;EAkBQ,kBAAuC;AAAA,QAEzC,KAAK,QAAwC;AACjD,SAAK,UAAU;AACf,SAAK,QAAQ;AAET,QAAA,QAAQ;AACV,WAAK,SAAS;AAAA,IAChB;QAEI;AACI,YAAA,eAAe,IAAI,MAAM,UAC1B,KAAK,QACR,OAAO,KAAK,OAAO,SAAS,IAAA,CAAA;UAG1B,OAAO,IAAI;AACb,aAAK,SAAA,CAAA,GAAa,OAAO,KAAK;AAAA,MAChC,OAAO;AACL,aAAK,QAAQ,OAAO,MAAM;AAAA,MAC5B;AAAA,IACF,SAAS,GAAG;AACV,WAAK,QAAQ,aAAa,QAAQ,EAAE,UAAU;AAAA,IAChD,UAAA;AACE,WAAK,UAAU;AAAA,IACjB;AAAA,EACF;AAAA,QAEM,eAAe,OAA0C;QACzD,KAAK,aAAa;;IAEtB;AAEM,UAAA,eAAe,IAAI,MAAM,UAAU,KAAK;QAE1C,OAAO,IAAI;AACb,WAAK,cAAc;AACnB,WAAK,sBAAA;AAAA,IACP,OAAO;AACL,WAAK,QAAQ,OAAO,MAAM;AAAA,IAC5B;AAAA,EACF;AAAA,EAEM,MAAA,gBAA+B;SAC9B,KAAK,aAAa;;IAEvB;AAEM,UAAA,SAAA,MAAe,IAAI,MAAM,YAAA;QAE3B,OAAO,IAAI;AACb,WAAK,cAAc;AACnB,WAAK,0BAAA;AAAA,IACP;AAAA,EACF;AAAA,EAEA,UAAU,QAA8B;AACtC,SAAK,SAAS;AAAA,EAChB;AAAA,EAEA,cAAoB;AAClB,SAAK;EACP;AAAA,EAEQ,wBAA8B;AACpC,SAAK,kBAAkB,IAAI,GAAG,SAAA,CAAU,UAAoB;AAC1D,WAAK,SAAA,CAAU,OAAA,GAAU,KAAK,MAAM,EAAE,MAAM,GAAG,UAAU;AAAA,IAC3D,CAAC;AAAA,EACH;AAAA,EAEQ,4BAAkC;QACpC,KAAK,iBAAiB;AACxB,WAAK,gBAAA;AACL,WAAK,kBAAkB;AAAA,IACzB;AAAA,EACF;AAAA,EAEA,UAAU,MAA0B;WAC3B,KAAK,OAAO,OAAA,CAAQ,MAAM,EAAE,SAAS,IAAI;AAAA,EAClD;AAAA,EAEA,UAAU,OAA2B;AAC5B,WAAA,KAAK,OAAO,MAAM,GAAG,KAAK;AAAA,EACnC;AACF;AAEa,MAAA,iBAAiB,WAAA;"}