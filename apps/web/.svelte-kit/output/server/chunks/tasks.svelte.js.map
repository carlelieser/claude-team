{"version":3,"file":"tasks.svelte.js","sources":["../../../../src/lib/stores/tasks.svelte.ts"],"sourcesContent":["/**\n * Task store using Svelte 5 runes\n */\n\nimport type { TaskStatus } from '@claude-team/core';\nimport {\n  ipc,\n  type TaskDto,\n  type CreateTaskDto,\n  type UpdateTaskDto,\n  type TaskFilterDto,\n} from '$lib/ipc/client';\n\nexport type ViewMode = 'kanban' | 'list';\n\nclass TaskStore {\n  tasks = $state<TaskDto[]>([]);\n  loading = $state(false);\n  error = $state<string | null>(null);\n  filter = $state<TaskFilterDto>({});\n  viewMode = $state<ViewMode>('kanban');\n\n  pendingTasks = $derived(this.tasks.filter((t) => t.status === 'pending'));\n  inProgressTasks = $derived(this.tasks.filter((t) => t.status === 'in_progress'));\n  completedTasks = $derived(this.tasks.filter((t) => t.status === 'completed'));\n  failedTasks = $derived(this.tasks.filter((t) => t.status === 'failed'));\n  canceledTasks = $derived(this.tasks.filter((t) => t.status === 'canceled'));\n\n  private _unsubscribeUpdated: (() => void) | null = null;\n\n  async load(filter?: TaskFilterDto): Promise<void> {\n    this.loading = true;\n    this.error = null;\n\n    if (filter) {\n      this.filter = filter;\n    }\n\n    try {\n      const result = await ipc.task.list(this.filter);\n\n      if (result.ok) {\n        this.tasks = [...result.value];\n      } else {\n        this.error = result.error.message;\n      }\n    } catch (e) {\n      this.error = e instanceof Error ? e.message : 'Unknown error';\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  async create(data: CreateTaskDto): Promise<TaskDto | null> {\n    try {\n      const result = await ipc.task.create(data);\n\n      if (result.ok) {\n        this.tasks = [...this.tasks, result.value];\n        return result.value;\n      } else {\n        this.error = result.error.message;\n        return null;\n      }\n    } catch (e) {\n      this.error = e instanceof Error ? e.message : 'Unknown error';\n      return null;\n    }\n  }\n\n  async update(id: string, data: UpdateTaskDto): Promise<TaskDto | null> {\n    try {\n      const result = await ipc.task.update(id, data);\n\n      if (result.ok) {\n        const index = this.tasks.findIndex((t) => t.id === id);\n        if (index !== -1) {\n          this.tasks[index] = result.value;\n        }\n        return result.value;\n      } else {\n        this.error = result.error.message;\n        return null;\n      }\n    } catch (e) {\n      this.error = e instanceof Error ? e.message : 'Unknown error';\n      return null;\n    }\n  }\n\n  async cancel(id: string): Promise<boolean> {\n    try {\n      const result = await ipc.task.cancel(id);\n\n      if (result.ok) {\n        const index = this.tasks.findIndex((t) => t.id === id);\n        if (index !== -1) {\n          this.tasks[index] = { ...this.tasks[index]!, status: 'canceled' };\n        }\n        return true;\n      } else {\n        this.error = result.error.message;\n        return false;\n      }\n    } catch (e) {\n      this.error = e instanceof Error ? e.message : 'Unknown error';\n      return false;\n    }\n  }\n\n  setFilter(filter: TaskFilterDto): void {\n    this.filter = filter;\n    this.load();\n  }\n\n  setViewMode(mode: ViewMode): void {\n    this.viewMode = mode;\n  }\n\n  subscribe(): void {\n    this._unsubscribeUpdated = ipc.on.taskUpdated((task: TaskDto) => {\n      const index = this.tasks.findIndex((t) => t.id === task.id);\n      if (index !== -1) {\n        this.tasks[index] = task;\n      } else {\n        this.tasks = [...this.tasks, task];\n      }\n    });\n  }\n\n  unsubscribe(): void {\n    if (this._unsubscribeUpdated) {\n      this._unsubscribeUpdated();\n      this._unsubscribeUpdated = null;\n    }\n  }\n\n  getById(id: string): TaskDto | undefined {\n    return this.tasks.find((t) => t.id === id);\n  }\n\n  getByStatus(status: TaskStatus): TaskDto[] {\n    return this.tasks.filter((t) => t.status === status);\n  }\n}\n\nexport const taskStore = new TaskStore();\n"],"names":[],"mappings":"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"}