{"version":3,"file":"agents.svelte.js","sources":["../../../../src/lib/stores/agents.svelte.ts"],"sourcesContent":["/**\n * Agent store using Svelte 5 runes\n */\n\nimport { ipc, type AgentDto, type AgentProgressPayload } from '$lib/ipc/client';\n\nclass AgentStore {\n  agents = $state<AgentDto[]>([]);\n  loading = $state(false);\n  error = $state<string | null>(null);\n\n  activeAgents = $derived(this.agents.filter((a) => a.status === 'executing'));\n  idleAgents = $derived(this.agents.filter((a) => a.status === 'idle'));\n  pausedAgents = $derived(this.agents.filter((a) => a.status === 'paused'));\n\n  private _unsubscribeProgress: (() => void) | null = null;\n\n  async load(): Promise<void> {\n    this.loading = true;\n    this.error = null;\n\n    try {\n      const result = await ipc.agent.list();\n\n      if (result.ok) {\n        this.agents = [...result.value];\n      } else {\n        this.error = result.error.message;\n      }\n    } catch (e) {\n      this.error = e instanceof Error ? e.message : 'Unknown error';\n    } finally {\n      this.loading = false;\n    }\n  }\n\n  async pause(agentId: string): Promise<void> {\n    const result = await ipc.agent.pause(agentId);\n\n    if (result.ok) {\n      const index = this.agents.findIndex((a) => a.id === agentId);\n      if (index !== -1) {\n        this.agents[index] = { ...this.agents[index]!, status: 'paused' };\n      }\n    }\n  }\n\n  async resume(agentId: string): Promise<void> {\n    const result = await ipc.agent.resume(agentId);\n\n    if (result.ok) {\n      const agent = this.agents.find((a) => a.id === agentId);\n      if (agent) {\n        const newStatus = agent.currentTaskId ? 'executing' : 'idle';\n        const index = this.agents.findIndex((a) => a.id === agentId);\n        if (index !== -1) {\n          this.agents[index] = { ...this.agents[index]!, status: newStatus };\n        }\n      }\n    }\n  }\n\n  subscribe(): void {\n    this._unsubscribeProgress = ipc.on.agentProgress((payload: AgentProgressPayload) => {\n      const index = this.agents.findIndex((a) => a.id === payload.agentId);\n      if (index !== -1) {\n        this.agents[index] = {\n          ...this.agents[index]!,\n          status: 'executing',\n          currentTaskId: payload.taskId,\n        };\n      }\n    });\n  }\n\n  unsubscribe(): void {\n    if (this._unsubscribeProgress) {\n      this._unsubscribeProgress();\n      this._unsubscribeProgress = null;\n    }\n  }\n\n  getById(id: string): AgentDto | undefined {\n    return this.agents.find((a) => a.id === id);\n  }\n}\n\nexport const agentStore = new AgentStore();\n"],"names":[],"mappings":";;AAMM,MAAA,WAAW;AAAA,EACf,SAAA,CAAA;AAAA,EACA,UAAiB;AAAA,EACjB,QAA8B;AAAA,gCAEN,KAAK,OAAO,OAAA,CAAQ,MAAM,EAAE,WAAW,WAAW,CAAA;AAAA,MAA1E,eAAA;;;;;;8BACsB,KAAK,OAAO,OAAA,CAAQ,MAAM,EAAE,WAAW,MAAM,CAAA;AAAA,MAAnE,aAAA;;;;;;gCACwB,KAAK,OAAO,OAAA,CAAQ,MAAM,EAAE,WAAW,QAAQ,CAAA;AAAA,MAAvE,eAAA;;;;;;EAEQ,uBAA4C;AAAA,EAE9C,MAAA,OAAsB;AAC1B,SAAK,UAAU;AACf,SAAK,QAAQ;QAET;AACI,YAAA,SAAA,MAAe,IAAI,MAAM,KAAA;UAE3B,OAAO,IAAI;AACb,aAAK,SAAA,CAAA,GAAa,OAAO,KAAK;AAAA,MAChC,OAAO;AACL,aAAK,QAAQ,OAAO,MAAM;AAAA,MAC5B;AAAA,IACF,SAAS,GAAG;AACV,WAAK,QAAQ,aAAa,QAAQ,EAAE,UAAU;AAAA,IAChD,UAAA;AACE,WAAK,UAAU;AAAA,IACjB;AAAA,EACF;AAAA,QAEM,MAAM,SAAgC;AACpC,UAAA,eAAe,IAAI,MAAM,MAAM,OAAO;QAExC,OAAO,IAAI;AACP,YAAA,QAAQ,KAAK,OAAO,UAAA,CAAW,MAAM,EAAE,OAAO,OAAO;UACvD,cAAc;AAChB,aAAK,OAAO,KAAK,IAAA,EAAA,GAAS,KAAK,OAAO,KAAK,GAAI,QAAQ,SAAA;AAAA,MACzD;AAAA,IACF;AAAA,EACF;AAAA,QAEM,OAAO,SAAgC;AACrC,UAAA,eAAe,IAAI,MAAM,OAAO,OAAO;QAEzC,OAAO,IAAI;AACP,YAAA,QAAQ,KAAK,OAAO,KAAA,CAAM,MAAM,EAAE,OAAO,OAAO;AAClD,UAAA,OAAO;AACH,cAAA,YAAY,MAAM,gBAAgB,cAAc;AAChD,cAAA,QAAQ,KAAK,OAAO,UAAA,CAAW,MAAM,EAAE,OAAO,OAAO;YACvD,cAAc;AAChB,eAAK,OAAO,KAAK,IAAA,EAAA,GAAS,KAAK,OAAO,KAAK,GAAI,QAAQ,UAAA;AAAA,QACzD;AAAA,MACF;AAAA,IACF;AAAA,EACF;AAAA,EAEA,YAAkB;AAChB,SAAK,uBAAuB,IAAI,GAAG,cAAA,CAAe,YAAkC;AAC5E,YAAA,QAAQ,KAAK,OAAO,UAAA,CAAW,MAAM,EAAE,OAAO,QAAQ,OAAO;UAC/D,cAAc;AAChB,aAAK,OAAO,KAAK,IAAA;AAAA,aACZ,KAAK,OAAO,KAAK;AAAA,UACpB,QAAQ;AAAA,UACR,eAAe,QAAQ;AAAA;MAE3B;AAAA,IACF,CAAC;AAAA,EACH;AAAA,EAEA,cAAoB;QACd,KAAK,sBAAsB;AAC7B,WAAK,qBAAA;AACL,WAAK,uBAAuB;AAAA,IAC9B;AAAA,EACF;AAAA,EAEA,QAAQ,IAAkC;WACjC,KAAK,OAAO,KAAA,CAAM,MAAM,EAAE,OAAO,EAAE;AAAA,EAC5C;AACF;AAEa,MAAA,iBAAiB,WAAA;"}